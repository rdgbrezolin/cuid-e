/*! zaz-mod-carousel - v1.0.0 - 03/08/2016 -- 1:08pm */
zaz.use(function modCarousel(pkg){"use strict";var console=pkg.console,require=pkg.require,define=pkg.define,STATIC={};pkg.require(["modFactory"],function(modFactory){modFactory.create({name:"carousel",version:"1.0.0",state:"ok",docs:"http://github.tpn.terra.com/pages/terra/zaz-mod-zaz-mod-carousel",source:"http://github.tpn.terra.com/Terra/zaz-mod-zaz-mod-carousel",tests:"http://s1.trrsf.com/fe/zaz-mod-zaz-mod-carousel/tests/index.htm?zaz[env]=tests",dependencies:["Promise"],description:"Módulo para criação e controle de carrosséis.",setup:function(data){function Carousel(settings){var PUBLIC=this,PRIVATE={},DISABLED_LINK_EXP=null,INDEX=0,itemWidth=0,itemHeight=0,carouselWidth=0,dragWidth=0,posScroll=0,qtdItems,qtdSteps,arGroup,bullet,mod,toDrag,validation,currentItem,intervalAutoplay;pkg.utils.make.observable(PUBLIC),PRIVATE={anchors:[],"interface":{},options:{vertical:!1,effects:!0,bullets:!1,axis:null,previousButtonSelector:".arrow-prev",nextButtonSelector:".arrow-next",disabledPreviousButtonClassName:"disabled",disabledNextButtonClassName:"disabled",wrapperBullets:".carousel-wrap-bulles",itemBullet:"carousel-item-bullet",carouselBullet:"carousel-bullet",step:{type:"item",size:1},effect:{type:"slider",duration:1e3,autoplay:!1,autoplayDuration:0}}},PUBLIC.buttons={prev:null,next:null,realTimeAction:"default",state:{prev:!1,next:!1}},PUBLIC.anchorPoint=INDEX,settings=pkg.utils.deepMerge(PRIVATE.options,settings),DISABLED_LINK_EXP=new RegExp(settings.disabledPreviousButtonClassName+"|"+settings.disabledNextButtonClassName,""),settings.axis=settings.vertical?"top":"left",validation=MODULE.validate({properties:{axis:{type:"string",required:!0,"enum":["top","left"]},containerSelector:{type:"string",required:!0},disabledNextButtonClassName:{type:"string",required:!0},disabledPreviousButtonClassName:{type:"string",required:!0},nextButtonSelector:{type:"string",required:!0},previousButtonSelector:{type:"string",required:!0},effects:{type:"boolean",required:!0},vertical:{type:"boolean",required:!0},bullets:{type:"boolean",required:!0},step:{type:"object",required:!0,properties:{type:{type:"string",required:!0},size:{type:"number",required:!0}}},effect:{type:"object",required:!1,properties:{type:{type:"string",required:!1},duration:{type:"number",required:!1},autoplay:{type:"boolean",required:!1},autoplayDuration:{type:"number",required:!1}}}}},settings),PRIVATE.interface.container=document.querySelector(settings.containerSelector),PRIVATE.interface.listContainer=document.querySelector(settings.containerSelector+" .thumblist"),PRIVATE.interface.list=PRIVATE.interface.listContainer.querySelector("ul"),PRIVATE.interface.items=PRIVATE.interface.list.querySelectorAll("li"),PRIVATE.interface.referenceItem=PRIVATE.interface.items[0],PRIVATE.interface.visibleArea=PRIVATE.interface.container.offsetWidth,PRIVATE.interface.listContainer.style.position="relative",PRIVATE.interface.list.style.position="absolute",PRIVATE.interface.list.style.overflow="hidden",PRIVATE.interface.list.style.margin=0,qtdItems=PRIVATE.interface.items.length,mod=qtdItems%settings.step.size,PRIVATE.bind=function(bp){var b={},config={status:!0,instance:PUBLIC};b.mouseleave=function(){PUBLIC.set("carousel-mouseleave",config)},b.mouseenter=function(){PUBLIC.set("carousel-mouseenter",config)},b.changePainel=function(){PUBLIC.set("carousel-changed-painel",config)},b.startAutoplay=function(){PUBLIC.set("carousel-start-autoplay",config)},b.stopAutoplay=function(){PUBLIC.set("carousel-stop-autoplay",config)},b.clickedBtnPass=function(){PUBLIC.set("carousel-clicked-btnPass",config)},b.clickedCarousel=function(){PUBLIC.set("carousel-clicked",config)},b.ready=function(){PUBLIC.set("ready",config)};try{if("function"!=typeof b[bp])throw new Error(b[bp]+" is not a function.");b[bp]()}catch(e){e.message="carousel bind error - "+e.message,console.log(e)}},PRIVATE.timerAnimate=function(timer){var time;return time=void 0!==timer?timer/1e3:settings.effect.duration/1e3,String(time)},PRIVATE.animate=function(timerAnimation){var animation=null,time=PRIVATE.timerAnimate(timerAnimation);if("fade"===settings.effect.type){animation="opacity "+time+"s ease-in-out";for(var i=0;qtdItems>i;i++)PRIVATE.interface.items[i].style.transition=animation,PRIVATE.interface.items[i].style.OTransition=animation,PRIVATE.interface.items[i].style.MozTransition=animation,PRIVATE.interface.items[i].style.WebkitTransition=animation}else animation="left "+time+"s linear",PRIVATE.interface.list.style.transition=animation,PRIVATE.interface.list.style.OTransition=animation,PRIVATE.interface.list.style.MozTransition=animation,PRIVATE.interface.list.style.WebkitTransition=animation},PRIVATE.wrap=function(objStep){var dragDimensions=PRIVATE.getDimensions(objStep);settings.vertical?(PRIVATE.interface.list.style.top="",PRIVATE.interface.listContainer.style.overflowY="hidden",PRIVATE.interface.list.style.height=dragDimensions.total+"px",PRIVATE.interface.list.style.top=INDEX+"px"):(PRIVATE.interface.listContainer.style.overflowX="hidden",(0!==dragDimensions.higher||0!==dragDimensions.total)&&(PRIVATE.interface.listContainer.style.height=dragDimensions.higher+"px",0!==dragDimensions.total&&(PRIVATE.interface.list.style.width=dragDimensions.total+"px")),toDrag=-1*(dragDimensions.total-PRIVATE.interface.visibleArea)),carouselWidth=PRIVATE.interface.container.offsetWidth,dragWidth=parseInt(PRIVATE.interface.list.style.width),PRIVATE.goToCalc()},PRIVATE.getDimensions=function(objStep){var totalDimension=0,higherDimension=0,itemDimension=0,item=null;if("item"===objStep.type)for(var tables=parseInt(qtdItems/objStep.size),i=0;qtdItems>i;i++)item=PRIVATE.interface.items[i],item.style.width="",item.style.height="",settings.vertical||"fade"===settings.effect.type||(item.style.float="left"),itemWidth=item.offsetWidth,itemHeight=item.offsetHeight,"fade"!==settings.effect.type&&(item.style.width=itemWidth+"px",item.style.height=itemHeight+"px"),item.style.display="block",itemDimension=settings.vertical?itemWidth:itemHeight,itemDimension>higherDimension&&(higherDimension=itemDimension),"fade"===settings.effect.type?(item.style.top=0,item.style.left=0,item.style.opacity=0,item.style.filter="alpha(opacity:0)",item.style.position="absolute",PRIVATE.interface.list.style.height=higherDimension+"px"):totalDimension+=settings.vertical?item.offsetHeight:item.offsetWidth;return{total:totalDimension,higher:higherDimension}},PRIVATE.defineButtonsStatus=function(){var currentPosition=-1*PRIVATE.interface.list.style[settings.axis].replace(/[^\d]*$/,"");PUBLIC.buttons.prev=document.querySelector(settings.containerSelector+" "+settings.previousButtonSelector),PUBLIC.buttons.next=document.querySelector(settings.containerSelector+" "+settings.nextButtonSelector),PUBLIC.buttons.prev.setAttribute("data-arrow",1),PUBLIC.buttons.prev.setAttribute("data-arrow-direct","prev"),PUBLIC.buttons.next.setAttribute("data-arrow",1),PUBLIC.buttons.next.setAttribute("data-arrow-direct","next"),PRIVATE.interface.items.length>1&&"fade"===settings.effect.type?(PUBLIC.buttons.state.prev=!0,PUBLIC.buttons.state.next=!0):(0>=currentPosition?(PUBLIC.buttons.prev.getClassList().add(settings.disabledPreviousButtonClassName),PUBLIC.buttons.state.prev=!0):(PUBLIC.buttons.prev.getClassList().remove(settings.disabledPreviousButtonClassName),PUBLIC.buttons.state.prev=!1),!settings.vertical&&PRIVATE.interface.list.offsetWidth-PRIVATE.interface.listContainer.offsetWidth-currentPosition<=0?(PUBLIC.buttons.next.getClassList().add(settings.disabledNextButtonClassName),PUBLIC.buttons.state.next=!0):settings.vertical&&PRIVATE.interface.list.offsetHeight-PRIVATE.interface.listContainer.offsetHeight-currentPosition<=0?(PUBLIC.buttons.next.getClassList().add(settings.disabledNextButtonClassName),PUBLIC.buttons.state.next=!0):(PUBLIC.buttons.next.getClassList().remove(settings.disabledNextButtonClassName),PUBLIC.buttons.state.next=!1))},PRIVATE.bullets=function(){var wrapBullets=document.querySelector(settings.containerSelector+" .carousel-wrap-bullets"),ul=document.createElement("ul");if(qtdSteps=arGroup.length,qtdSteps>1)for(var i=0;qtdSteps>i;i++){var li=document.createElement("li"),btn=document.createElement("button");li.getClassList().add(settings.itemBullet),btn.textContent=i,btn.setAttribute("data-index",i),btn.setAttribute("data-bullet",1),btn.getClassList().add(settings.carouselBullet),li.appendChild(btn),ul.appendChild(li)}wrapBullets.innerHTML=ul.innerHTML},PRIVATE.bulletAction=function(ix){var idx=parseInt(ix);idx||(idx=0),INDEX!==idx?(INDEX=idx*settings.step.size,PUBLIC.anchorPoint=INDEX,PRIVATE.bulletMarkup(parseInt(INDEX/settings.step.size)),"fade"===settings.effect.type?PUBLIC.fade(INDEX):PUBLIC.scroll(arGroup[idx]),PRIVATE.bind("clickedBtnPass")):console.log("[mod.carousel] - Not change, bullets idx === atual idx")},PRIVATE.bulletMarkup=function(i){null!==document.querySelector(settings.containerSelector+" .current-carousel-bullet")&&document.querySelector(settings.containerSelector+" .current-carousel-bullet").getClassList().remove("current-carousel-bullet"),document.querySelectorAll(settings.containerSelector+" ."+settings.carouselBullet)[i]&&document.querySelectorAll(settings.containerSelector+" ."+settings.carouselBullet)[i].getClassList().add("current-carousel-bullet")},PRIVATE.nav=function(){var btnPrev=document.querySelector(settings.containerSelector+" "+settings.previousButtonSelector),btnNext=document.querySelector(settings.containerSelector+" "+settings.nextButtonSelector);"web"!==pkg.context.platform.get("type")&&pkg.require(["mod.hammer"],function(Hammer){var h=new Hammer(PRIVATE.interface.listContainer,{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_HORIZONTAL}]]});h.on("swipe",function(e){e.direction===Hammer.DIRECTION_LEFT?PRIVATE.onAction("next",null,btnPrev):e.direction===Hammer.DIRECTION_RIGHT&&PRIVATE.onAction("prev",null,btnNext)})}),settings.effect.autoplay&&(document.querySelector(settings.containerSelector).addEventListener("mouseenter",function(){PRIVATE.bind("mouseenter")}),document.querySelector(settings.containerSelector).addEventListener("mouseleave",function(){PRIVATE.bind("mouseleave")})),document.querySelector(settings.containerSelector).addEventListener("click",function(evt){var clicked=evt.target;clicked.getAttribute("data-bullet")?PRIVATE.bulletAction(evt.target.getAttribute("data-index")):clicked.getAttribute("data-arrow")?(PRIVATE.onAction(clicked.getAttribute("data-arrow-direct"),evt,this),PRIVATE.bind("clickedBtnPass")):PRIVATE.bind("clickedCarousel")})},PRIVATE.onAction=function(action,evt,elem){return evt&&(evt.preventDefault(),evt.stopPropagation()),elem.className.match(DISABLED_LINK_EXP)?!1:void PUBLIC[action].call()},PRIVATE.goToCalc=function(){var nItems=(qtdItems-mod)/settings.step.size,lastScrol=-1*(dragWidth-carouselWidth);arGroup=[],arGroup[0]=0;for(var i=0;nItems>i;i++)i>0&&arGroup.push(i*itemWidth*settings.step.size*-1);lastScrol!==arGroup[arGroup.length-1]&&lastScrol<arGroup[arGroup.length-1]&&arGroup.push(lastScrol)},PUBLIC.elements={container:PRIVATE.interface.container,listContainer:PRIVATE.interface.listContainer,list:PRIVATE.interface.list,items:PRIVATE.interface.items},PUBLIC.setScrollAmount=function(objStep){objStep.size?settings.step.size=objStep.size:settings.vertical?settings.step.size=PRIVATE.interface.referenceItem.offsetHeight:(PRIVATE.interface.referenceItem=PRIVATE.interface.items[0],settings.step.size=PRIVATE.interface.referenceItem.offsetWidth),PRIVATE.wrap(objStep)},PUBLIC.fade=function(anchorPoint){anchorPoint||(anchorPoint=0),currentItem&&(currentItem.style.opacity=0,currentItem.style.zIndex=0,currentItem.style.filter="alpha(opacity:0)"),currentItem=PRIVATE.interface.items[anchorPoint],currentItem.style.opacity=1,currentItem.style.zIndex=1,currentItem.style.filter="alpha(opacity:100)",settings.effect.autoplay&&PUBLIC.autoplay(),PRIVATE.bind("changePainel")},PUBLIC.scroll=function(anchorPoint){var step=itemWidth*settings.step.size;switch(PUBLIC.buttons.realTimeAction){case"prev":0>posScroll+step?posScroll+=step:posScroll=0;break;case"next":posScroll+=posScroll+-1*step>toDrag?-1*step:toDrag-posScroll;break;case"goto":posScroll=anchorPoint;break;case"default":posScroll=anchorPoint}if(settings.effects){var config=settings.vertical?{top:posScroll}:{left:posScroll};PRIVATE.interface.list.style.left=config.left+"px"}else PRIVATE.interface.listContainer.css(settings.axis,posScroll);settings.effect.autoplay&&PUBLIC.autoplay(),PUBLIC.buttons.realTimeAction="default",PRIVATE.defineButtonsStatus(),PRIVATE.bind("changePainel")},PUBLIC.goTo=function(index){PUBLIC.buttons.realTimeAction="goto",INDEX=index,PUBLIC.anchorPoint=INDEX,settings.bullets&&PRIVATE.bulletMarkup(parseInt(INDEX/settings.step.size)),"fade"===settings.effect.type?PUBLIC.fade(INDEX):PUBLIC.scroll(arGroup[parseInt(INDEX/settings.step.size)])},PUBLIC.rePosition=function(index){PRIVATE.animate(0),index||(index=INDEX),PUBLIC.setScrollAmount(settings.step),PUBLIC.goTo(index),PRIVATE.animate(settings.effect.duration)},PUBLIC.next=function(){PUBLIC.buttons.realTimeAction="next",INDEX+=settings.step.size,INDEX===qtdItems&&(INDEX=0),PUBLIC.anchorPoint=INDEX,settings.bullets&&PRIVATE.bulletMarkup(parseInt(INDEX/settings.step.size)),"fade"===settings.effect.type?PUBLIC.fade(INDEX):PUBLIC.scroll(INDEX)},PUBLIC.prev=function(){PUBLIC.buttons.realTimeAction="prev",INDEX-=settings.step.size,-1===INDEX&&(INDEX=qtdItems-1),PUBLIC.anchorPoint=INDEX,settings.bullets&&PRIVATE.bulletMarkup(parseInt(INDEX/settings.step.size)),"fade"===settings.effect.type?PUBLIC.fade(INDEX):PUBLIC.scroll(INDEX)},PUBLIC.autoplay=function(){intervalAutoplay&&clearInterval(intervalAutoplay),intervalAutoplay=setInterval(PUBLIC.next,settings.effect.autoplayDuration),PRIVATE.bind("startAutoplay")},PUBLIC.stopAutoplay=function(){clearInterval(intervalAutoplay),PRIVATE.bind("stopAutoplay")},function Constructor(){return validation!==!0?console.error(new Error(validation)):(PUBLIC.setScrollAmount(settings.step),PRIVATE.defineButtonsStatus(),PRIVATE.animate(settings.effect.duration),"fade"===settings.effect.type?PUBLIC.fade(0):PUBLIC.scroll(0),settings.bullets&&(PRIVATE.bullets(),PRIVATE.bulletMarkup(0),PRIVATE.bulletAction(),document.getElementsByClassName(settings.carouselBullet)[INDEX]&&document.getElementsByClassName(settings.carouselBullet)[INDEX].getClassList().add("current-carousel-bullet")),PRIVATE.nav(),pkg.context.page.on("range",function(newRange){PUBLIC.rePosition(INDEX),settings.bullets&&(PRIVATE.bullets(),PRIVATE.bulletMarkup(INDEX),PRIVATE.bulletAction())}),PRIVATE.interface.listContainer.addClass("loaded"),void PRIVATE.bind("ready"))}()}var PUBLIC_STATIC={},PRIVATE_STATIC={dependencies:this.dependencies,anchors:[]},MODULE=this,Promise=data.dependencies.Promise;return Carousel},teardown:function(reason){}})})});